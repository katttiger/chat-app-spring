MODELLERING

1. KONCEPT

GAMLA ENTITETER:
- users
- messages

NYA ENTITETER
- kommentarer
- profilsida
- taggar

1.2. ATTRIBUT

USERS
- Id
- Username
- Password

Messages
- Id
- Text
- Publiceringsdatum

KOMMENTARER
- Id
- Text

PROFILSIDA
- Id
- Bild
- Beskrivning av användaren

TAGGAR
- Id
- Namn

1. 3. RELATIONER
- USER har relationer till MESSAGES, KOMMENTARER och PROFILSIDA

    -> USER-MESSAGES (1-*)
    -> USER-KOMMENTARER (1-*)
    -> USER-PROFILSIDA (1-1)

- MESSAGES har relationer till USER, KOMMENTARER och TAGGAR

    -> MESSAGES-TAGGAR (*-*)
    -> MESSAGES-USER (*-1)
    -> MESSAGES-KOMMENTARER (1-*)

- KOMMENTARER har relationer till MESSAGES och USERS

    -> KOMMENTARER-MESSAGES (*-1)
    -> KOMMENTARER-USERS (*-1)

- PROFILSIDA har en relation till USER

    -> PROFILSIDA-USER (1-1)

- TAGGAR har relationer till MESSAGES

    -> TAGGAR-MESSAGES (*-*)

1.4. KONTROLL AV MODELLEN

ANVÄNDARE KAN KOMMENTERA MEDDELANDEN | JA
KOMMENTAREN HAR EN ANVÄNDARE | JA

ANVÄNDARE HAR EN PROFIL | JA
PROFILEN HAR EN BILD | JA
PROFILEN HAR EN ANVÄNDARBESKRIVNING | JA
PROFILEN KAN UPPDATERAS | JA
EN PROFILBILD ÄR KOPPLAD TILL EN ANVÄNDARE | JA

MEDDELANDEN KAN HA FLERA TAGGAR | JA
EN TAGG KAN ANVÄNDAS FLERA GÅNGER | JA

---

2. LOGISK MODELL

USER
    user_id (PK)
    username
    password

MESSAGES
    message_id (PK)
    text
    timestamp
    user (FK message_id [*-1] user_id)
    tag (FK message_id [*-*] tag_id)

KOMMENTARER
    comment_id (PK)
    text
    message (FK comment_id [*-1] message_id)
    user (FK comment_id [*-1] user_id)

TAGGAR
    tag_id (PK)
    message (FK tag_id [*-*] message_id)

PROFILSIDA
    profile_id (PK)
    image
    user_description
    user (FK user_id 1-1 profile_id)


Då KOMMENTARER och MEDDELANDEN har en många-många relation krävs att en
tabell skapas som kopplar ihop dem med hjälp av en sammanslagen nyckel (composite key)
som använder respektive tabells id.

TAG-MESSAGE
    tag_id (FK)
    message_id (FK)

---

SQL

CREATE TABLE users (
id BIGINT PRIMARY KEY AUTO_INCREMENT,
user_name VARCHAR(120) NOT NULL,
password VARCHAR(120) NOT NULL,

);

CREATE TABLE profile(
    id BIGINT PRIMARY KEY AUTOINCREMENT,
    image MEDIA NOT NULL,
    user_description VARCHAR(120) NOT NULL,
    user_id BIGINT NOT NULL,

CONSTRAINT
    fk_user_profile FOREIGN KEY (user_id) REFERENCES profile(profile_id)
)

CREATE TABLE messages (
id BIGINT PRIMARY KEY AUTO_INCREMENT,
text VARCHAR(255) NOT NULL,
timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
user_id BIGINT NOT NULL,

CONSTRAINT
    fk_message_user FOREIGN KEY (user_id) REFERENCES users(id)
);

CREATE TABLE comments(
id BIGINT PRIMARY KEY AUTO_INCREMENT,
text VARCHAR(255) NOT NULL,
user_id BIGINT NOT NULL,
message_id BIGINT NOT NULL

CONSTRAINT
    fk_comment_user FOREIGN KEY (user_id) REFERENCES users(id),
    fk_comment_message FOREIGN KEY (message_id) REFERENCES message(id)

);

CREATE TABLE tags (
id BIGINT PRIMARY KEY AUTO_INCREMENT,
name VARCHAR(255) NOT NULL,
)

CREATE TABLE tags_message(tag_id INT
message_id INT
PRIMARY KEY (tag_id, message_id),
FOREIGN KEY (tag_id) REFERENCES tags(id)
FOREIGN KEY (message_id) REFERENCES messages(id)
)